.. _data_management:

******************************
Data Generation and Management
*******************************


Data management section consists of two folds: generation of the 
source data and data management. To generate the source data, we make use of
the *Example 2* in `chs replication files`__. 

.. _chs: https://www.econometricsociety.org/content/supplement-estimating-technology-cognitive-and-noncognitive-skill-formation-0
__ chs_

Data generation
===============

In the file :file:`src/data_management/generate_data.do`, the source data 
including factors and measurements for each period as well as the control 
variables are simulated. Exactly the same parameters in the *Example 2* are used. 
These parameters are stored in the several json file in *${PATH_OUT_MODEL_SPECS}*
path. The files are imported via the following lines.

.. literalinclude:: ../data_management/generate_data.do
    :start-after: log using `"${PATH_OUT_DATA}/log/`1'.log"', replace
    :end-before: set obs ${obs}
    
Each factor at first period is drawn from true prior distributions which is
assumed to be normal distribution with mean zero with differing variances 
for each factors, and stored as **fac11, fac21, fac31**
 

Then, the measurements of the first period are generated by using the factors of first period and 
measurement equations via loop; stored as **{y11, y21, ..., y91}**


For subsequent periods of factor 1 and factor 2 transition equations are utilized.
Note that factor 3 is a time-invariant factor. Within the same loop the subsequent 
measurement values are generated as well by iterating period form 2 to 8. The 
factors are mesurements are indexed by factor/measurement numbers and periods 
in which the first index is the number, and the second one refers to time.


The resulted data is saved in *${PATH_OUT_DATA}/source_data*


Data management
================


In the file :file:`src/data_management/data_management.do", we organize the
generated data :file:`bld/out/data/source_data/data_gen.dta` to conform the 
second normal form.

Three tables are generated.

i) :file:`bld/out/data/tables/data_table_1.dta`

ii) :file:`bld/out/data/tables/data_table_1.dta`

iii) :file:`bld/out/data/tables/data_table_1.dta`

*data_table_1.dta* includes generated variable factorid which is an identification 
for each factor in the dataset in a way that
the first digit represent the id of a child (caseid in the original data), the 
second digit stands for factor number (1, 2, 3) and th third digit represents the
time period. 
Each factor is matched with corresponding measurements 1, 2 and 3. The variable 
"true" stands for the "true" value of factor generated from the simulated data. 

*data_table_2.dta* matches the factorid with factor number, period,
caseid and key for measurement. 

*data_table_3.dta* matches the values of controls for each observation to control_id
which is the same key for controls in data_table_2.dta.
(caseid).

This specification allows us to merge the tables via *factorid* variable in 
:file:`src/analysis/prepare_data.py`. 






















